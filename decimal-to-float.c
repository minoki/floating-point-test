#include <float.h>
#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(void)
{
    printf("DECIMAL_DIG = %d\n", DECIMAL_DIG);
    struct {
        const char *s;
        double expected;
        double incorrect;
    } const cases[] = {
                 {"1.0000000000000002220446049250313080847263336181640625", 0x1.0000000000001p0, 0x1.0000000000001p0},
                 {"1.000000000000000444089209850062616169452667236328125", 0x1.0000000000002p0},
                 {"1.00000000000000011102230246251565404236316680908203125", 0x1.0000000000000p0, 0x1.0000000000001p0}, // exactly 0x1.00000000000008p0
                 {"1.00000000000000011102230246251565404236316680908203126", 0x1.0000000000001p0, 0x1.0000000000000p0}, // slightly larger than 0x1.00000000000008p0
                 {"1.00000000000000011102230246251565404236316680908203125000000000000000000000000000000000000000000000001", 0x1.0000000000001p0, 0x1.0000000000000p0}, // slightly larger than 0x1.00000000000008p0
                 {"1.00000000000000011102230246251565404236316680908203124999999999999999999999999999999999999999999999999", 0x1.0000000000000p0, 0x1.0000000000001p0}, // slightly smaller than 0x1.00000000000008p0
                 {"3.054936363499605021218048345404395812996405650508864889071311886714731794308928064006118855266224095988998224331888535361431386289845561110038055713845300810725746486029854642394937641054852977058926622473820563909429908021790438489147088951763630468033446824280128631737341102925998501963651016860766158037428075764017391837508390676658025464343690581646691768920309772994414743152447044849395751953125e-151", 0x1.0000000000000p-500, 0x1.0000000000001p-500}, // exactly 0x1.00000000000008p-500
                 {"3.054936363499605021218048345404395812996405650508864889071311886714731794308928064006118855266224095988998224331888535361431386289845561110038055713845300810725746486029854642394937641054852977058926622473820563909429908021790438489147088951763630468033446824280128631737341102925998501963651016860766158037428075764017391837508390676658025464343690581646691768920309772994414743152447044849395751953124e-151", 0x1.0000000000000p-500, 0x1.0000000000001p-500}, // slightly smaller than 0x1.00000000000008p-500
                 {"3.054936363499605021218048345404395812996405650508864889071311886714731794308928064006118855266224095988998224331888535361431386289845561110038055713845300810725746486029854642394937641054852977058926622473820563909429908021790438489147088951763630468033446824280128631737341102925998501963651016860766158037428075764017391837508390676658025464343690581646691768920309772994414743152447044849395751953126e-151", 0x1.0000000000001p-500, 0x1.0000000000000p-500}, // slightly larger than 0x1.00000000000008p-500
                 {"1.6885085030572711014139699940929938233299652850086384629984592687930283202953925561993975384975173893621838161211910490162582725178572410441231192774132857651807865382044267779215438302389955143871025976438694779678114763562885597494740848432292732262367007787091163241621852563994643016586643809517155437052601336755258180094261267856164217066444823612971778485435027823989244772102098261773137622255741798894640760123025859334862516089382430146704474546787425734587198430977674857437392595417140148229500521242295350210121366385933078420322761559191349078901112079620361328125e-226", 0x1.0000000000000p-750, 0x1.0000000000001p-750}, // exactly 0x1.00000000000008p-750
                 {"1.6885085030572711014139699940929938233299652850086384629984592687930283202953925561993975384975173893621838161211910490162582725178572410441231192774132857651807865382044267779215438302389955143871025976438694779678114763562885597494740848432292732262367007787091163241621852563994643016586643809517155437052601336755258180094261267856164217066444823612971778485435027823989244772102098261773137622255741798894640760123025859334862516089382430146704474546787425734587198430977674857437392595417140148229500521242295350210121366385933078420322761559191349078901112079620361328124e-226", 0x1.0000000000000p-750, 0x1.0000000000001p-750}, // slightly smaller than 0x1.00000000000008p-750
                 {"1.6885085030572711014139699940929938233299652850086384629984592687930283202953925561993975384975173893621838161211910490162582725178572410441231192774132857651807865382044267779215438302389955143871025976438694779678114763562885597494740848432292732262367007787091163241621852563994643016586643809517155437052601336755258180094261267856164217066444823612971778485435027823989244772102098261773137622255741798894640760123025859334862516089382430146704474546787425734587198430977674857437392595417140148229500521242295350210121366385933078420322761559191349078901112079620361328126e-226", 0x1.0000000000001p-750, 0x1.0000000000000p-750}, // slightly larger than 0x1.00000000000008p-750
                 {"1.6885085030572714763381734680007325277410746920249768479888833285701028046290044606271115015450930821042159154749001096386701795193224898900334949352808430555247378820088718109605996875112350839903811732986572045717140445629306063405096074762326703026096934093808125256573903756619577255032480692647501380185238358229013622426099244540116519323970062103906991213275240634575800500460662260036159371039585486647332927419524656446960433145546390286386988719030975414687994496562807298360158698194534268924708274065478579927239099157799235260968284677574047236703336238861083984375e-226", 0x1.0000000000002p-750, 0x1.0000000000001p-750}, // exactly 0x1.00000000000018p-750
                 {"1.6885085030572714763381734680007325277410746920249768479888833285701028046290044606271115015450930821042159154749001096386701795193224898900334949352808430555247378820088718109605996875112350839903811732986572045717140445629306063405096074762326703026096934093808125256573903756619577255032480692647501380185238358229013622426099244540116519323970062103906991213275240634575800500460662260036159371039585486647332927419524656446960433145546390286386988719030975414687994496562807298360158698194534268924708274065478579927239099157799235260968284677574047236703336238861083984374e-226", 0x1.0000000000001p-750, 0x1.0000000000002p-750}, // slightly smaller than 0x1.00000000000018p-750
                 {"1.6885085030572714763381734680007325277410746920249768479888833285701028046290044606271115015450930821042159154749001096386701795193224898900334949352808430555247378820088718109605996875112350839903811732986572045717140445629306063405096074762326703026096934093808125256573903756619577255032480692647501380185238358229013622426099244540116519323970062103906991213275240634575800500460662260036159371039585486647332927419524656446960433145546390286386988719030975414687994496562807298360158698194534268924708274065478579927239099157799235260968284677574047236703336238861083984376e-226", 0x1.0000000000002p-750, 0x1.0000000000001p-750}, // slightly larger than 0x1.00000000000018p-750
                 {"9.3326361850321898260316527545000443091505115648932677443470385701960774744036215722010446937116354154132323247808871175172801193969181547967151816084191634596274676649864887790677440283469609434919160731514796478974087901921663400413575497066220322552211216096724748494169028724344015761385185790938882912171953879169474345570496716690741715715085072632377066955496979399844757156182723700161535085389951198151521917625873409844287610508523866347344025273389245159972127636560173127088351984619752255621769938544186759364215330495246797849873290680290415275474298580585546344568626096756424816296711706062093000187584278505612007051750524005944614614138320813630354021765714132396818924240761801205997732396317696779153294528441620059311389923095703125e-302", 0x1.0000000000000p-1000, 0x1.0000000000001p-1000}, // exactly 0x1.00000000000008p-1000
                 {"9.3326361850321898260316527545000443091505115648932677443470385701960774744036215722010446937116354154132323247808871175172801193969181547967151816084191634596274676649864887790677440283469609434919160731514796478974087901921663400413575497066220322552211216096724748494169028724344015761385185790938882912171953879169474345570496716690741715715085072632377066955496979399844757156182723700161535085389951198151521917625873409844287610508523866347344025273389245159972127636560173127088351984619752255621769938544186759364215330495246797849873290680290415275474298580585546344568626096756424816296711706062093000187584278505612007051750524005944614614138320813630354021765714132396818924240761801205997732396317696779153294528441620059311389923095703124e-302", 0x1.0000000000000p-1000, 0x1.0000000000001p-1000}, // slightly smaller than 0x1.00000000000008p-1000
                 {"9.3326361850321898260316527545000443091505115648932677443470385701960774744036215722010446937116354154132323247808871175172801193969181547967151816084191634596274676649864887790677440283469609434919160731514796478974087901921663400413575497066220322552211216096724748494169028724344015761385185790938882912171953879169474345570496716690741715715085072632377066955496979399844757156182723700161535085389951198151521917625873409844287610508523866347344025273389245159972127636560173127088351984619752255621769938544186759364215330495246797849873290680290415275474298580585546344568626096756424816296711706062093000187584278505612007051750524005944614614138320813630354021765714132396818924240761801205997732396317696779153294528441620059311389923095703126e-302", 0x1.0000000000001p-1000, 0x1.0000000000000p-1000}, // slightly larger than 0x1.00000000000008p-1000
                 {"9.33263618513987593176935378818258389165683390723613588248218427235382348382259715460075073888350137739299464187129603255903334203825604946125439800322242401661993315303985480294993124871227119997022531328805035494332049967010505664302714528588480814467900928566995732137671186260308219333572293369301930408113408294733116102933929369580006390978283590441728607488269765287670238072468379662216334417453326577286811556420626172830691751792194023670392210416768209699118931787543578888178652689189897945097678247321491727693489393549195379466636499984361490871116470237388752573522537171771202745259518069720305515956351025106196370758552558529752128055586663700057713281081332259222417031388481370688234140908616509602069299944560043513774871826171875e-302", 0x1.000000000cafep-1000, 0x1.000000000cafep-1000}, // exactly 0x1.000000000cafep-1000
                 {"2.4703282292062327208828439643411068618252990130716238221279284125033775363510437593264991818081799618989828234772285886546332835517796989819938739800539093906315035659515570226392290858392449105184435931802849936536152500319370457678249219365623669863658480757001585769269903706311928279558551332927834338409351978015531246597263579574622766465272827220056374006485499977096599470454020828166226237857393450736339007967761930577506740176324673600968951340535537458516661134223766678604162159680461914467291840300530057530849048765391711386591646239524912623653881879636239373280423891018672348497668235089863388587925628302755995657524455507255189313690836254779186948667994968324049705821028513185451396213837722826145437693412532098591327667236328125e-324", 0.0, 0x1p-1074}, // exactly 0x1p-1075
                 {"2.4703282292062327208828439643411068618252990130716238221279284125033775363510437593264991818081799618989828234772285886546332835517796989819938739800539093906315035659515570226392290858392449105184435931802849936536152500319370457678249219365623669863658480757001585769269903706311928279558551332927834338409351978015531246597263579574622766465272827220056374006485499977096599470454020828166226237857393450736339007967761930577506740176324673600968951340535537458516661134223766678604162159680461914467291840300530057530849048765391711386591646239524912623653881879636239373280423891018672348497668235089863388587925628302755995657524455507255189313690836254779186948667994968324049705821028513185451396213837722826145437693412532098591327667236328124e-324", 0.0, 0x1p-1074}, // slightly smaller than 0x1p-1075
                 {"2.47032822920623272088284396434110686182529901307162382212792841250337753635104375932649918180817996189898282347722858865463328355177969898199387398005390939063150356595155702263922908583924491051844359318028499365361525003193704576782492193656236698636584807570015857692699037063119282795585513329278343384093519780155312465972635795746227664652728272200563740064854999770965994704540208281662262378573934507363390079677619305775067401763246736009689513405355374585166611342237666786041621596804619144672918403005300575308490487653917113865916462395249126236538818796362393732804238910186723484976682350898633885879256283027559956575244555072551893136908362547791869486679949683240497058210285131854513962138377228261454376934125320985913276672363281250000001e-324", 0x1p-1074, 0x0p-1074}, // slightly larger than 0x1p-1075
                 {"2.4703282292062327208828439643411068618252990130716238221279284125033775363510437593264991818081799618989828234772285886546332835517796989819938739800539093906315035659515570226392290858392449105184435931802849936536152500319370457678249219365623669863658480757001585769269903706311928279558551332927834338409351978015531246597263579574622766465272827220056374006485499977096599470454020828166226237857393450736339007967761930577506740176324673600968951340535537458516661134223766678604162159680461914467291840300530057530849048765391711386591646239524912623653881879636239373280423891018672348497668235089863388587925628302755995657524455507255189313690836254779186948667994968324049705821028513185451396213837722826145437693412532098591327667236328125000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e-324", 0x1p-1074, 0x0p-1074}, // slightly larger than 0x1p-1075
                 {"179769313486231580793728971405303415079934132710037826936173778980444968292764750946649017977587207096330286416692887910946555547851940402630657488671505820681908902000708383676273854845817711531764475730270069855571366959622842914819860834936475292719074168444365510704342711559699508093042880177904174497792", INFINITY, 0x1.fffffffffffffp1023}, // exactly 0x1.fffffffffffff8p1023
                 {"179769313486231580793728971405303415079934132710037826936173778980444968292764750946649017977587207096330286416692887910946555547851940402630657488671505820681908902000708383676273854845817711531764475730270069855571366959622842914819860834936475292719074168444365510704342711559699508093042880177904174497791.99999999999999", 0x1.fffffffffffffp1023, INFINITY}, // slightly smaller than 0x1.fffffffffffff8p1023
                 {"179769313486231580793728971405303415079934132710037826936173778980444968292764750946649017977587207096330286416692887910946555547851940402630657488671505820681908902000708383676273854845817711531764475730270069855571366959622842914819860834936475292719074168444365510704342711559699508093042880177904174497792.00000000000001", INFINITY, 0x1.fffffffffffffp1023}, // slightly larger than 0x1.fffffffffffff8p1023
    };
    for (size_t i = 0; i < sizeof(cases) / sizeof(cases[0]); ++i) {
        const char *s = cases[i].s;
        double x = strtod(s, NULL);
        printf("Case #%zu:\nInput: %s (length=%zu)\n", i, s, strlen(s));
        printf("Expected: %a\n", cases[i].expected);
        printf("Result: %a; %s\n", x, x == cases[i].expected ? "correct rounding" : (x == cases[i].incorrect || cases[i].expected == cases[i].incorrect) ? "incorrect rounding" : "non-faithful rounding");
        puts("---");
    }
}
